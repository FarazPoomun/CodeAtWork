
@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Shared/CodeAtWorkAppLayout.cshtml";
}
<link href="~/Content/CodeAtWorkApp/Home.css" rel="stylesheet" />
<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<script src="~/Scripts/CodeAtWorkApp/SharedAppJs.js"></script>

<div id="HomeMain">

    <div id="HomeProgress">
        <div>
            <span class="dot homeDot">@ViewBag.Initial</span>
            <a id="HelloHome"> Hello, @ViewBag.FirstName <i style="font-size:medium" class="far fa-caret-square-down"></i> </a>
        </div>
    </div>

    <div id="HomeVids">
        <div class="vidScreenshotWrapper">
            <p class="vidScreenshotHeader">Recommended Watch</p>
            <div class="HomeScreenshots">
                @ViewBag.RecommendedWatch
            </div>

            <p class="vidScreenshotHeader">Recommended Watch</p>

            <div>
                <div class="vidGrid" style="background-image: url('../../Uploads/766d9ac9-3bab-40a3-844f-210406ac8d0b.jpg'); ">
                    <div class="innerScreenshot">
                        <svg id="opt_766d9ac9-3bab-40a3-844f-210406ac8d0b" role="img" viewBox="0 0 24 24" class="optSvg" onclick="toggleOptionMenu('766d9ac9-3bab-40a3-844f-210406ac8d0b')">
                            <path fill="currentColor" fill-rule="evenodd" d="M6 14.5a2 2 0 110-4 2 2 0 010 4zm12 0a2 2 0 110-4 2 2 0 010 4zm-6 0a2 2 0 110-4 2 2 0 010 4z"></path>
                        </svg>
                        <div class="optMenu" id="optMenu_766d9ac9-3bab-40a3-844f-210406ac8d0b" style="display: block;">
                            <ul class="optMenuList"><li onclick="OpenPlayer('766d9ac9-3bab-40a3-844f-210406ac8d0b')">Play <i class="far fa-play-circle optMenuListRight" aria-hidden="true"></i></li><li>Add To Bookmark <i class="fas fa-bookmark optMenuListRight" aria-hidden="true"></i></li><li onclick="showOptChannel('766d9ac9-3bab-40a3-844f-210406ac8d0b')" id="optMenuChannelBtn_766d9ac9-3bab-40a3-844f-210406ac8d0b">Add To Channel <i class="fas fa-caret-right optMenuListRight" aria-hidden="true"></i></li></ul>
                        </div>
                        <div class="optMenuChannel" id="optMenuChannel_766d9ac9-3bab-40a3-844f-210406ac8d0b" style="display: block;">
                            <div class="optMenuChannelDiv1">
                                <input type="text" placeholder="Add New Channel" class="ChannelAddBar" id="ChannelAddBar_766d9ac9-3bab-40a3-844f-210406ac8d0b" onkeyup="EnableAddChannelBtn(this, '766d9ac9-3bab-40a3-844f-210406ac8d0b')">
                                <button type="submit" class="ChannelAddBtn" id="ChannelAddBtn_766d9ac9-3bab-40a3-844f-210406ac8d0b" onclick="AddNewChannel('766d9ac9-3bab-40a3-844f-210406ac8d0b')">
                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                </button>
                            </div> <div style="padding-bottom: 5%;">
                                <ul class="optMenuList ChannelList" id="ChannelList_766d9ac9-3bab-40a3-844f-210406ac8d0b">
                                    <li>Blah <i onclick="AddOrRemoveChannelFromVid(this, 12, '766d9ac9-3bab-40a3-844f-210406ac8d0b')" class="fas fa-check-circle optMenuListRight channelUnselected" aria-hidden="true"></i></li>
                                    <li>new <i onclick="AddOrRemoveChannelFromVid(this, 13, '766d9ac9-3bab-40a3-844f-210406ac8d0b')" class="fas fa-check-circle optMenuListRight channelUnselected" aria-hidden="true"></i></li>
                                    <li>C# <i onclick="AddOrRemoveChannelFromVid(this, 15, '766d9ac9-3bab-40a3-844f-210406ac8d0b')" class="fas fa-check-circle optMenuListRight channelUnselected" aria-hidden="true"></i></li>
                                </ul>
                            </div>
                        </div>
                        <svg onclick="BookMarkVid(this,'766d9ac9-3bab-40a3-844f-210406ac8d0b')" role="img" viewBox="0 0 24 24" class="bookmarkingSvg bookmarkUnselected"><path fill="currentColor" fill-rule="evenodd" d="M17.501 2H9C6.794 2 5 3.795 5 6v17l5.5-6 5.5 6V10h4a1 1 0 001-1V6c0-2.205-1.292-4-3.499-4zM14 6v12l-3.5-4L7 18V6c0-1.104.897-2 2-2h5.536A3.99 3.99 0 0014 6zm5 2h-3V6c0-1.104.398-2 1.501-2C18.603 4 19 4.896 19 6v2z"></path></svg>
                        <i onclick="OpenPlayer('766d9ac9-3bab-40a3-844f-210406ac8d0b')" class="far fa-play-circle" aria-hidden="true"></i>
                    </div>
                </div>
                <p class="vidDesc" onclick="OpenPlayer('766d9ac9-3bab-40a3-844f-210406ac8d0b')"> Nullable Types in C# </p>
                <p class="vidBy"> kudvenkat <i class="fas fa-circle dotSeperator" aria-hidden="true"></i> Beginner</p>
            </div>
        </div>
    </div>
</div>


<script>
    var globalVidId= 0;
    function OpenPlayer(id) {
    var url = '@Url.Action("AppPlayer", "CodeAtWorkApp", new { playById = "__id" })';
    var New = url.replace("__id", id)
    window.open(New, "_blank");
    }

    function AddNewChannel(vidId) {
        var elem = document.getElementById("ChannelAddBar_" + vidId);
        if (!IsNullOrEmpty(elem.value)) {
            var ajaxPost = $.post('/CodeAtWorkApp/AddAndLinkChannel', { channelName: elem.value, videoId: vidId });
            Promise.all([ajaxPost]).then((results) => {
                document.getElementById("ChannelAddBar_" + vidId).value = "";
                document.getElementById("ChannelList_" + vidId).innerHTML = results;
                var btn = document.getElementById("ChannelAddBtn_" + vidId);
                $(btn).css("pointer-events", "none");
                $(btn).css("background", "grey");
            });
        }
    }

    function AddOrRemoveChannelFromVid(elem, channelId, vidId) {
        var ajaxPost = $.post('/CodeAtWorkApp/AddOrRemoveChannelFromVid', { videoId: vidId, channelId: channelId, IsSelected: !elem.classList.contains("channelSelected")});
            Promise.all([ajaxPost]).then((results) => {
                document.getElementById("ChannelList_" + vidId).innerHTML = results;
            });
    }

    function EnableAddChannelBtn(elem, vidId) {
        var btn = document.getElementById("ChannelAddBtn_" + vidId);
        var val = elem.value;
        if (!IsNullOrEmpty(val)) {
            $(btn).css("pointer-events", "all");
            $(btn).css("background", "#0084bd");

        }
        else {
            $(btn).css("pointer-events", "none");
            $(btn).css("background", "grey");
        }
    }

    function toggleOptionMenu(vidId) {
        var x = document.getElementById("optMenu_" + vidId);
        if (x.style.display === "none" || x.style.display === "") {
            x.style.display = "block";
            globalVidId = vidId;
            document.addEventListener("click", menuHasOpenedEvnt);
        }
         else {
            document.removeEventListener("click", menuHasOpenedEvnt);
            x.style.display = "none";
                }
    }

    function menuHasOpenedEvnt(evt) {
        const elem = document.getElementById("optMenu_" + globalVidId);
        const parentElem = document.getElementById("opt_" + globalVidId);
        const child1 = document.getElementById("optMenuChannel_" + globalVidId);
        const child2 = document.getElementById("optMenuChannelBtn_" + globalVidId);

            let targetElement = evt.target; // clicked element

        do {
            if (targetElement == elem || targetElement == parentElem || targetElement == child1 || targetElement == child2) {
                    // This is a click inside. Do nothing, just return.
                    return;
                }
                // Go up the DOM
                targetElement = targetElement.parentNode;
        } while (targetElement);

        // This is a click outside.
        elem.style.display = "none";
        document.removeEventListener("click", menuHasOpenedEvnt);
    }

    function showOptChannel(vidId) {
        var x = document.getElementById("optMenuChannel_" + vidId);
        if (x.style.display === "none" || x.style.display === "") {
            x.style.display = "block";
            globalVidId = vidId;
            document.addEventListener("click", ChannelMenuHasOpenedEvnt);
            var ajaxPost = $.post('/CodeAtWorkApp/GetVideoChannels', { vidId: vidId });
            Promise.all([ajaxPost]).then((results) => {
                document.getElementById("ChannelList_" + vidId).innerHTML = results;
            });
        }
        else {
            document.removeEventListener("click", ChannelMenuHasOpenedEvnt);
            x.style.display = "none";
        }
    }

    function ChannelMenuHasOpenedEvnt(evt) {
        const elem = document.getElementById("optMenuChannel_" + globalVidId);
        const parentElem = document.getElementById("optMenuChannelBtn_" + globalVidId);
        let targetElement = evt.target; // clicked element

        do {
            if (targetElement == elem || targetElement == parentElem) {
                // This is a click inside. Do nothing, just return.
                return;
            }
            // Go up the DOM
            targetElement = targetElement.parentNode;
        } while (targetElement);

        // This is a click outside.
        elem.style.display = "none";
        document.removeEventListener("click", ChannelMenuHasOpenedEvnt);
    }

</script>